# Chaingraph Execution Worker Configuration
# ==========================================
# Single-process worker using DBOS for durable workflow execution.
# DBOS handles concurrency control and work distribution via PostgreSQL-backed queues.
# For horizontal scaling, deploy multiple replicas via Kubernetes.

# Database
# --------
DATABASE_URL=postgres://postgres@0.0.0.0:5432/postgres?sslmode=disable
DATABASE_URL_EXECUTIONS=postgres://postgres@0.0.0.0:5432/postgres?sslmode=disable

# DBOS Configuration (Required)
# -----------------------------
# Enable DBOS-based execution
ENABLE_DBOS_EXECUTION=true

# Application name for DBOS (used in logs and monitoring)
DBOS_APPLICATION_NAME=chaingraph-executor

# Concurrency Limits
# - DBOS_QUEUE_CONCURRENCY: Global max concurrent workflows across all workers
# - DBOS_WORKER_CONCURRENCY: Max concurrent workflows per worker process
DBOS_QUEUE_CONCURRENCY=100
DBOS_WORKER_CONCURRENCY=5

# DBOS Admin Server (local management UI)
# Note: Only enable on one instance to avoid port conflicts
DBOS_ADMIN_ENABLED=true
DBOS_ADMIN_PORT=3022

# Health Server
# -------------
# Port for Kubernetes liveness/readiness probes
HEALTH_PORT=9090

# Logging
# -------
# Log level: debug, info, warn, error
LOG_LEVEL=info
# Environment: development, production
NODE_ENV=development

# ============================================================
# User Management Integration (Read-Only)
# ============================================================
# The execution worker has read-only access to user management tables for:
#   - Future secrets management (user-specific API keys, OAuth tokens)
#   - External account token access (GitHub, Google, etc.)
#   - User-specific node features
#
# NO authentication is performed by the worker (no HTTP endpoints).
# Auth is handled by the API layer (chaingraph-execution-api).
#
# Required database tables (automatically validated on startup):
#   - chaingraph_users
#   - chaingraph_external_accounts
#
# These tables are created by running migrations in the chaingraph-trpc package:
#   cd packages/chaingraph-trpc
#   pnpm run migrate
