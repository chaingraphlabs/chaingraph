# Worker Configuration

# Number of worker processes (auto = CPU cores)
WORKER_COUNT=auto

# Delay before restarting failed worker (ms)
WORKER_RESTART_DELAY=1000

# Maximum restart attempts per worker
MAX_WORKER_RESTARTS=-1

# Execution Mode
# 'local' or 'distributed'
EXECUTION_MODE=distributed

# Database
DATABASE_URL=postgres://postgres@0.0.0.0:5435/postgres?sslmode=disable
DATABASE_URL_EXECUTIONS=postgres://postgres@0.0.0.0:5435/postgres?sslmode=disable

# Kafka (required for distributed mode)
KAFKA_BROKERS=localhost:9092
KAFKA_TOPICS_PREFIX=dev.

# Health Monitoring
# Port for health endpoint
HEALTH_PORT=9090
# Worker heartbeat interval (ms)
HEARTBEAT_INTERVAL=5000

# Logging
# debug, info, warn, error
LOG_LEVEL=info
# development, production
NODE_ENV=development

# DBOS Configuration (Optional - for new execution engine)
# ============================================================
# Enable DBOS-based execution (replaces Kafka for task distribution and event streaming)
ENABLE_DBOS_EXECUTION=false

# DBOS Conductor Configuration (optional for production)
# DBOS_CONDUCTOR_URL=https://conductor.dbos.dev
DBOS_APPLICATION_NAME=chaingraph-executor-worker
# DBOS_CONDUCTOR_KEY=your-api-key-here

# DBOS System Database (defaults to DATABASE_URL_EXECUTIONS)
# DBOS_SYSTEM_DATABASE_URL=postgres://postgres@0.0.0.0:5435/postgres?sslmode=disable

# DBOS Admin Server (local management UI)
# Note: Only one instance should have admin enabled to avoid port conflicts
DBOS_ADMIN_ENABLED=false
DBOS_ADMIN_PORT=3022

# DBOS Concurrency Limits
DBOS_QUEUE_CONCURRENCY=100
DBOS_WORKER_CONCURRENCY=5

# ============================================================
# User Management Integration
# ============================================================
# The execution worker has read-only access to user management tables for:
#   - Future secrets management (user-specific API keys, OAuth tokens)
#   - External account token access (GitHub, Google, etc.)
#   - User-specific node features
#
# NO authentication is performed by the worker (no HTTP endpoints).
# Auth is handled by the API layer (chaingraph-execution-api).
#
# Required database tables (automatically validated on startup):
#   - chaingraph_users
#   - chaingraph_external_accounts
#
# These tables are created by running migrations in the chaingraph-trpc package:
#   cd packages/chaingraph-trpc
#   pnpm run migrate
#
# No auth-specific environment variables are needed by the worker
# (DEMO_TOKEN_SECRET, AUTH_ENABLED, etc. are for API servers only)